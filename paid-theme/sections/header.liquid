{% comment %}
  Modern Parts Store Header - Clean White & Orange Design
  Professional appearance with modern styling
{% endcomment %}

{% liquid
  assign logo = section.settings.logo
  assign logo_width = section.settings.logo_width | default: 200
  assign search_enabled = section.settings.enable_search | default: true
%}

{{ 'espares-header.css' | asset_url | stylesheet_tag }}

<header class="parts-header">
  <!-- Top promotional bar -->
  <div class="parts-top-bar" role="note" aria-label="Store notice">
    <div class="parts-header-content" style="justify-content:center; font-size:14px; font-weight:600; letter-spacing:.5px;">
      Trusted by millions of customers | Genuine Parts | Price Match Promise
    </div>
  </div>
  <!-- Main header -->
  <div class="parts-main-header">
    <div class="parts-header-content">
      <!-- Logo -->
      <div class="parts-logo">
        <a href="{{ routes.root_url }}" title="{{ shop.name | escape }}">
          {%- if logo -%}
            <img src="{{ logo | image_url: width: logo_width }}" alt="{{ shop.name | escape }}" width="{{ logo_width }}" height="{{ logo_width | divided_by: logo.aspect_ratio | round }}">
          {%- else -%}
            <span class="parts-logo-text">
              PartsFix
              <span class="tagline">the parts store</span>
            </span>
          {%- endif -%}
        </a>
      </div>
      
      <!-- Search bar -->
      {%- if search_enabled -%}
        <div class="parts-search-container">
          <form action="{{ routes.search_url }}" method="get" role="search" class="parts-search-form">
            <input 
              type="search" 
              name="q" 
              maxlength="120" 
              placeholder="Search your brand, part or model..." 
              class="parts-search-input" 
              value="{{ search.terms | escape }}" 
              spellcheck="false">
            <button type="submit" class="parts-search-button">Search</button>
          </form>
        </div>
      {%- endif -%}
      
      <!-- Header actions -->
      <div class="parts-header-actions">
        <!-- Account -->
        {%- if customer -%}
          <div class="parts-account-dropdown">
            <a href="{{ routes.account_url }}" class="parts-account">
              <svg class="parts-icon" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
              </svg>
              My Account
              <svg class="parts-dropdown-arrow" fill="currentColor" viewBox="0 0 20 20" style="width: 12px; height: 12px; margin-left: 4px;">
                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
              </svg>
            </a>
            <div class="parts-account-menu">
              <a href="{{ routes.account_url }}" class="parts-account-link">
                <svg fill="currentColor" viewBox="0 0 24 24" style="width: 16px; height: 16px;">
                  <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                </svg>
                Account Details
              </a>
              <a href="{{ routes.account_addresses_url }}" class="parts-account-link">
                <svg fill="currentColor" viewBox="0 0 24 24" style="width: 16px; height: 16px;">
                  <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                </svg>
                Addresses
              </a>
              <a href="{{ routes.account_logout_url }}" class="parts-account-link">
                <svg fill="currentColor" viewBox="0 0 24 24" style="width: 16px; height: 16px;">
                  <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.59L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
                </svg>
                Log Out
              </a>
            </div>
          </div>
        {%- else -%}
          <a href="{{ routes.account_login_url }}" class="parts-account">
            <svg class="parts-icon" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
            </svg>
            Log In
          </a>
        {%- endif -%}
        
        <!-- Basket with Hover Cart Preview -->
        <div class="parts-basket-container" id="cart-preview-container">
          <a href="{{ routes.cart_url }}" class="parts-basket" id="cart-icon">
            <svg class="parts-icon" fill="currentColor" viewBox="0 0 24 24">
              <path d="M7 18c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12L8.1 13h7.45c.75 0 1.41-.41 1.75-1.03L21.7 4H5.21l-.94-2H1zm16 16c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
            </svg>
            Basket
            {%- if cart.item_count > 0 -%}
              <span class="parts-basket-count">{{ cart.item_count }}</span>
            {%- else -%}
              <span class="parts-basket-count">0</span>
            {%- endif -%}
          </a>
          
          <!-- Cart Preview Dropdown -->
          <div class="cart-preview-dropdown" id="cart-preview">
            <div class="cart-preview-header">
              <h3>Your Cart ({{ cart.item_count }} items)</h3>
            </div>
            
            {%- if cart.item_count > 0 -%}
              <div class="cart-preview-items">
                {%- for item in cart.items limit: 3 -%}
                  <div class="cart-preview-item">
                    <div class="cart-preview-image">
                      {%- if item.image -%}
                        <img src="{{ item.image | image_url: width: 60 }}" alt="{{ item.title }}" loading="lazy" width="60" height="60">
                      {%- else -%}
                        <div class="cart-preview-no-image"></div>
                      {%- endif -%}
                    </div>
                    <div class="cart-preview-details">
                      <div class="cart-preview-title">{{ item.title }}</div>
                      <div class="cart-preview-price">{{ item.quantity }} Ã— {{ item.price | money }}</div>
                    </div>
                  </div>
                {%- endfor -%}
                
                {%- if cart.item_count > 3 -%}
                  <div class="cart-preview-more">
                    +{{ cart.item_count | minus: 3 }} more items
                  </div>
                {%- endif -%}
              </div>
              
              <div class="cart-preview-footer">
                <div class="cart-preview-total">
                  <strong>Total: {{ cart.total_price | money }}</strong>
                </div>
                <a href="{{ routes.cart_url }}" class="cart-preview-button">View Cart</a>
              </div>
            {%- else -%}
              <div class="cart-preview-empty">
                <p>Your cart is empty</p>
              </div>
            {%- endif -%}
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Navigation menu -->
  <nav class="parts-navigation" aria-label="Primary">
    <div class="parts-nav-content">
      {%- comment -%} Static mega menu data {%- endcomment -%}
      {%- assign mega_menu_categories = "Kitchen Appliances|Washers & Dryers|Floorcare|Garden|Sound & Vision|Household" | split: "|" -%}
      <ul class="parts-nav-list" role="menubar">
        {%- for top_name in mega_menu_categories -%}
          {%- case top_name -%}
            {%- when 'Kitchen Appliances' -%}
              {%- assign children = "Cooker Hood|Cooker & Oven|Dishwasher|Fridge / Freezer|Fridge Water Filters|Kitchen (Small Appliances)|Microwave|Accessories|Shop By Brand" | split: "|" -%}
            {%- when 'Washers & Dryers' -%}
              {%- assign children = "Tumble Dryer|Washing Machine|Accessories|Shop By Brand" | split: "|" -%}
            {%- when 'Floorcare' -%}
              {%- assign children = "Vacuum Cleaner|Steam Cleaner|Floor Polisher|Accessories|Shop By Brand" | split: "|" -%}
            {%- when 'Garden' -%}
              {%- assign children = "Lawnmowers|Grass Trimmers|Garden Vacs|Pressure Washers|Chainsaws|Hedge Trimmers|Accessories|Shop By Brand" | split: "|" -%}
            {%- when 'Sound & Vision' -%}
              {%- assign children = "TV / Projector|DVD / Video / Home Cinema|Audio / HiFi|Accessories|Shop By Brand" | split: "|" -%}
            {%- when 'Household' -%}
              {%- assign children = "Lighting & Bulbs|Batteries & Chargers|Appliance Cleaning|Breakfast|Bakeware|General Accessories" | split: "|" -%}
            {%- else -%}
              {%- assign children = blank -%}
          {%- endcase -%}
          <li class="parts-nav-item has-mega" role="none">
            <a href="#" class="parts-nav-link" role="menuitem" aria-haspopup="true" aria-expanded="false">{{ top_name }}</a>
            <div class="parts-mega" data-mega="{{ top_name | handleize }}" hidden>
              <div class="parts-mega-inner">
                <div class="parts-mega-col">
                  <h3 class="parts-mega-heading">Spare Parts</h3>
                  <ul class="parts-mega-links">
                    {%- for c in children -%}
                      <li><a href="#" title="{{ c }}">{{ c }}</a></li>
                    {%- endfor -%}
                  </ul>
                </div>
                {%- if top_name == 'Kitchen Appliances' -%}
                  <div class="parts-mega-col brands">
                    <h3 class="parts-mega-heading">Top Brands</h3>
                    <ul class="parts-mega-brands">
                      {%- assign top_brands = 'Bosch,Hotpoint,Beko,Indesit,Zanussi,Neff,Samsung,Siemens' | split: ',' -%}
                      {%- for b in top_brands -%}
                        <li><a href="#" title="{{ b }}">{{ b }}</a></li>
                      {%- endfor -%}
                      <li class="view-all"><a href="#" title="All Brands">View all &raquo;</a></li>
                    </ul>
                  </div>
                {%- endif -%}
              </div>
            </div>
          </li>
        {%- endfor -%}
      </ul>
    </div>
  </nav>

  <style>
  /* Modern Parts Store Header Inline Styles */
  .parts-top-bar { 
    background: linear-gradient(135deg, var(--primary-orange), var(--accent-orange)); 
    color: var(--pure-white); 
    padding: 12px 0; 
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
  }
  .parts-top-bar a { 
    color: var(--pure-white); 
    text-decoration: none; 
    font-weight: 600;
  }
  .parts-top-bar a:hover { 
    text-decoration: underline; 
  }
  .parts-orange-banner { 
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
  }
  .parts-navigation { 
    background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%) !important; 
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
  }
  .parts-nav-list { 
    list-style: none; 
    margin: 0; 
    padding: 0 24px; 
    display: flex; 
    gap: 8px; 
  }
  .parts-nav-link { 
    display: block; 
    padding: 16px 20px; 
    color: var(--pure-white) !important; 
    text-decoration: none; 
    font-weight: 600; 
    font-size: 16px; 
    position: relative; 
    border-radius: var(--border-radius-small);
    transition: var(--transition);
  }
  .parts-nav-link:hover, .parts-nav-link:focus { 
    color: var(--primary-orange); 
    background: rgba(255, 107, 53, 0.1);
    transform: translateY(-1px);
  }
  .has-mega { position: relative; }
  .parts-mega { 
    position: absolute; 
    top: 100%; 
    left: 0; 
    right: 0; 
    background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); 
    border-top: 3px solid var(--primary-orange); 
    box-shadow: var(--shadow-heavy); 
    padding: 32px 40px; 
    border-radius: 0 0 var(--border-radius) var(--border-radius);
    z-index: 9999;
    margin-top: 2px;
  }
  .parts-mega-inner { 
    max-width: 1400px; 
    margin: 0 auto; 
    display: flex; 
    gap: 60px; 
  }
  .parts-mega-col { flex: 1 1 280px; }
  .parts-mega-heading { 
    margin: 0 0 16px; 
    font-size: 18px; 
    font-weight: 800; 
    color: var(--pure-white); 
    text-transform: uppercase; 
    letter-spacing: 1px; 
  }
  .parts-mega-links, .parts-mega-brands { 
    list-style: none; 
    margin: 0; 
    padding: 0; 
    columns: 2; 
    column-gap: 32px; 
  }
  .parts-mega-links li, .parts-mega-brands li { 
    break-inside: avoid; 
    margin: 0 0 8px; 
  }
  .parts-mega-links a, .parts-mega-brands a { 
    color: var(--pure-white); 
    text-decoration: none; 
    font-size: 15px; 
    font-weight: 500;
    line-height: 1.4; 
    transition: var(--transition);
  }
  .parts-mega-links a:hover, .parts-mega-brands a:hover { 
    color: var(--primary-orange); 
    transform: translateX(4px);
  }
  .parts-mega-col.brands .parts-mega-brands { 
    columns: 1; 
    display: grid; 
    grid-template-columns: repeat(2, minmax(0, 1fr)); 
    gap: 8px 20px; 
  }
  .parts-mega-brands .view-all { 
    grid-column: 1/-1; 
    margin-top: 8px; 
  }
  .parts-mega-brands .view-all a { 
    font-weight: 700; 
    color: var(--primary-orange); 
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  @media (max-width: 980px){
    .parts-nav-list { flex-wrap: wrap; }
    .parts-mega { 
      position: static; 
      box-shadow: none; 
      padding: 16px 0 24px; 
      border-top: none; 
    }
    .parts-mega[hidden] { display: none !important; }
    .parts-mega-inner { flex-direction: column; gap: 32px; }
    .parts-mega-links, .parts-mega-brands { columns:1; }
  }
  /* Mega menu width fix: make panel span full navigation instead of narrow li */
  .parts-nav-content { position:relative; }
  .has-mega { position:static; }
  .has-mega > .parts-mega { left:0; right:0; width:100%; }
  .parts-mega[hidden]{ display:none !important; }
  /* Prevent overlapping decorative icons (theme base may inject pseudo-elements) */
  .parts-mega-heading { display:flex; align-items:center; gap:8px; padding-left:0; position:relative; }
  .parts-mega-heading:before, .parts-mega-heading:after, .parts-mega-col:before { content:none !important; display:none !important; }
  /* If existing global CSS applied background icons, strip them */
  .parts-mega-heading { background:none !important; }
  
  /* Cart Preview Dropdown Styling */
  .parts-basket-container {
    position: relative;
  }
  
  .cart-preview-dropdown {
    position: absolute;
    top: 100%;
    right: 0;
    width: 350px;
    background: var(--pure-white);
    border: 1px solid #e0e0e0;
    border-radius: 12px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.3s ease;
    z-index: 9999;
    margin-top: 8px;
  }
  
  .parts-basket-container:hover .cart-preview-dropdown {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }
  
  .cart-preview-header {
    padding: 20px;
    border-bottom: 1px solid #f0f0f0;
    background: linear-gradient(135deg, #2c3e50, #34495e);
    color: var(--pure-white);
    border-radius: 12px 12px 0 0;
  }
  
  .cart-preview-header h3 {
    margin: 0;
    font-size: 16px;
    font-weight: 600;
    color: var(--pure-white);
  }
  
  .cart-preview-items {
    max-height: 240px;
    overflow-y: auto;
    padding: 16px;
  }
  
  .cart-preview-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 0;
    border-bottom: 1px solid #f0f0f0;
  }
  
  .cart-preview-item:last-child {
    border-bottom: none;
  }
  
  .cart-preview-image {
    width: 50px;
    height: 50px;
    border-radius: 8px;
    overflow: hidden;
    flex-shrink: 0;
    background: #f8f9fa;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .cart-preview-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  .cart-preview-no-image {
    width: 100%;
    height: 100%;
    background: #e9ecef;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .cart-preview-details {
    flex: 1;
    min-width: 0;
  }
  
  .cart-preview-title {
    font-size: 14px;
    font-weight: 500;
    color: var(--text-dark);
    margin-bottom: 4px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  
  .cart-preview-price {
    font-size: 13px;
    color: var(--primary-orange);
    font-weight: 600;
  }
  
  .cart-preview-more {
    text-align: center;
    padding: 12px;
    font-size: 14px;
    color: var(--text-muted);
    font-style: italic;
  }
  
  .cart-preview-footer {
    padding: 16px 20px;
    border-top: 1px solid #f0f0f0;
    background: #f8f9fa;
    border-radius: 0 0 12px 12px;
  }
  
  .cart-preview-total {
    margin-bottom: 12px;
    text-align: center;
    font-size: 16px;
    color: var(--text-dark);
  }
  
  .cart-preview-button {
    display: block;
    width: 100%;
    padding: 12px 20px;
    background: linear-gradient(135deg, var(--primary-orange), var(--accent-orange));
    color: var(--pure-white);
    text-decoration: none;
    border-radius: 8px;
    text-align: center;
    font-weight: 600;
    transition: all 0.3s ease;
  }
  
  .cart-preview-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4);
  }
  
  .cart-preview-empty {
    padding: 40px 20px;
    text-align: center;
    color: var(--text-muted);
  }
  
  .cart-preview-empty p {
    margin: 0;
    font-size: 14px;
  }
  
  /* Account Dropdown Styles */
  .parts-account-dropdown {
    position: relative;
  }
  
  .parts-account-dropdown .parts-account {
    display: flex;
    align-items: center;
  }
  
  .parts-dropdown-arrow {
    transition: transform 0.3s ease;
  }
  
  .parts-account-dropdown:hover .parts-dropdown-arrow {
    transform: rotate(180deg);
  }
  
  .parts-account-menu {
    position: absolute;
    top: 100%;
    right: 0;
    background: white;
    min-width: 200px;
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.3s ease;
    z-index: 1000;
    border: 1px solid #e0e0e0;
    margin-top: 8px;
  }
  
  .parts-account-dropdown:hover .parts-account-menu {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }
  
  .parts-account-link {
    display: flex;
    align-items: center;
    padding: 12px 16px;
    color: var(--text-dark);
    text-decoration: none;
    font-size: 14px;
    transition: background-color 0.2s ease;
    border-bottom: 1px solid #f0f0f0;
  }
  
  .parts-account-link:last-child {
    border-bottom: none;
  }
  
  .parts-account-link:hover {
    background-color: #f8f9fa;
    color: var(--primary-orange);
  }
  
  .parts-account-link svg {
    margin-right: 8px;
    color: var(--text-muted);
  }
  
  .parts-account-link:hover svg {
    color: var(--primary-orange);
  }
  
  /* Mobile adjustments */
  @media (max-width: 768px) {
    .cart-preview-dropdown {
      width: 280px;
      right: -20px;
    }
    
    .parts-account-menu {
      width: 220px;
      right: -20px;
    }
  }
  </style>
  <script>
  // Accessible mega menu toggle (hover + focus + keyboard)
  document.addEventListener('DOMContentLoaded', function(){
    const items = document.querySelectorAll('.parts-nav-item.has-mega');
    items.forEach(item=>{
      const link = item.querySelector('.parts-nav-link');
      const panel = item.querySelector('.parts-mega');
      if(!link || !panel) return;
      function open(){ panel.hidden=false; link.setAttribute('aria-expanded','true'); }
      function close(){ panel.hidden=true; link.setAttribute('aria-expanded','false'); }
      item.addEventListener('mouseenter', open);
      item.addEventListener('mouseleave', close);
      link.addEventListener('focus', open);
      item.addEventListener('focusout', e=>{ if(!item.contains(e.relatedTarget)) close(); });
      link.addEventListener('keydown', e=>{ if(e.key==='Escape'){ close(); link.focus(); } });
    });
    // Close all on ESC globally
    document.addEventListener('keydown', e=>{ if(e.key==='Escape'){ document.querySelectorAll('.parts-mega:not([hidden])').forEach(p=>{ p.hidden=true; }); document.querySelectorAll('.parts-nav-link[aria-expanded="true"]').forEach(l=>l.setAttribute('aria-expanded','false')); } });
  });
  </script>
  <!-- Info bar -->
  <div class="parts-info-bar">
    <div class="parts-info-content">
      <div class="parts-info-item">
        <svg class="parts-info-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5l-3-4zM6 18.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm13.5-9l1.96 2.5H17V9.5h2.5z"/></svg>
        Next Day Delivery Order By 9PM*
      </div>
      <div class="parts-info-item">
        <svg class="parts-info-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M20 6h-2c0-2.21-1.79-4-4-4S10 3.79 10 6H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-6-2c1.1 0 2 .9 2 2h-4c0-1.1.9-2 2-2z"/></svg>
        Over 1 Million Products
      </div>
      <div class="parts-info-item">
        <svg class="parts-info-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
        Over 500 Brands
      </div>
    </div>
  </div>

  <!-- Promotional banner -->
  <div class="parts-promo-banner">
    <div class="parts-promo-content">
      Wide range of genuine spare parts and accessories for your household and garden appliances at low prices
    </div>
  </div>
</header>

{% schema %}
{
  "name": "PartsFix Header",
  "class": "section-header",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo image"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 100,
      "max": 300,
      "step": 10,
      "default": 200,
      "unit": "px",
      "label": "Logo width"
    },
    {
      "type": "link_list",
      "id": "menu",
      "default": "main-menu",
      "label": "Navigation menu"
    },
    {
      "type": "checkbox",
      "id": "enable_search",
      "default": true,
      "label": "Enable search"
    }
  ]
}
{% endschema %}
